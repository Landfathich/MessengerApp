{% extends 'base.html' %}
{% load static %}

{% block title %}–ß–∞—Ç —Å {{ other_user.username }} - MessengerApp{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'chat/css/chat.css' %}">
{% endblock %}

{% block content %}
    <div style="height: 100%; display: flex; flex-direction: column;">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞ -->
        <div class="chat-header">
            <div class="chat-header-content">
                <a href="{% url 'chat_dashboard' %}" class="chat-back-button">‚Üê</a>
                <div class="chat-user-avatar">
                    {{ other_user.username|first|upper }}
                </div>
                <div class="chat-user-info">
                    <h2>{{ other_user.username }}</h2>
                    <p class="chat-user-status">‚óè –æ–Ω–ª–∞–π–Ω</p>
                </div>
            </div>
        </div>

        <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
        <div class="chat-messages" id="chatMessages">
            {% for message in messages %}
                <div class="message {% if message.sender == user %}own{% else %}other{% endif %}">
                    {% if message.sender != user %}
                        <div class="message-avatar">
                            {{ message.sender.username|first|upper }}
                        </div>
                    {% endif %}

                    <div class="message-content">
                        {% if message.sender != user %}
                            <div class="message-sender">{{ message.sender.username }}</div>
                        {% endif %}

                        <div class="message-text">{{ message.content }}</div>

                        <div class="message-time">
                            {{ message.timestamp|date:"H:i" }}
                        </div>
                    </div>

                    {% if message.sender == user %}
                        <div class="message-avatar">
                            {{ message.sender.username|first|upper }}
                        </div>
                    {% endif %}
                </div>
            {% empty %}
                <div class="empty-chat">
                    <div class="empty-chat-icon">üí¨</div>
                    <p>–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</p>
                    <p style="font-size: 14px; opacity: 0.7;">–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ –ø–µ—Ä–≤—ã–º!</p>
                </div>
            {% endfor %}
        </div>

        <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ -->
        <div class="chat-input-container">
            <div class="chat-input-wrapper">
            <textarea
                    id="messageInput"
                    class="message-input"
                    placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
                    rows="1"
            ></textarea>
                <button onclick="sendMessage()" class="send-button">
                    –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                </button>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script src="{% static 'chat/js/chat.js' %}"></script>
    <script>
        // –ü–µ—Ä–µ–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ JS
        document.body.setAttribute('data-user-initial', '{{ user.username|first|upper }}');
        document.body.setAttribute('data-current-username', '{{ user.username }}');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —á–∞—Ç
        initializeChat({{ conversation.id }}, '{{ user.username }}');
    </script>
{% endblock %}